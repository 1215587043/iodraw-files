```mermaid
graph TD
    A[开始] --> B[读取用户问卷数据]
    B --> C{数据预处理}
    C --> C1[删除'建议'字段]
    C1 --> C2[多选字段拆分]
    C2 --> C3[分类变量编码]
    C3 --> C4[异常值处理]
    C4 --> D[特征工程]
    D --> E[特征与目标分离]
    E --> F[数据标准化]
    F --> G[拆分训练集/测试集]
    G --> H[网格搜索优化K值]
    H --> I[训练KNN模型]
    I --> J{模型评估达标?}
    J -- 是 --> K[保存模型]
    J -- 否 --> H
    K --> L[接收新用户输入]
    L --> M[输入数据预处理]
    M --> N[特征对齐]
    N --> O[标准化转换]
    O --> P[模型预测]
    P --> Q[生成推荐结果]
    Q --> R[结束]

# 关键节点说明
## 数据预处理阶段
- 多选字段拆分：将类似"1,3,5"的选项拆分为多个二进制特征
- 异常值处理：用Z-score方法过滤3σ以外的数据
- 特征对齐：确保预测时输入数据与训练时特征维度一致

## 模型训练阶段
- 网格搜索范围：n_neighbors=1-14
- 评估标准：5折交叉验证准确率

## 预测阶段
- 输入要求：需包含问卷所有原始字段
- 输出形式：推荐盲盒类型ID+置信度（可扩展）
```